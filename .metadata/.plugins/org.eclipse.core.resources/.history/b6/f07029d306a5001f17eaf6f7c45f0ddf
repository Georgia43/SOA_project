package fr.insa.ms.notificationService.controller;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.Statement;
import java.util.Random;

import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import fr.insa.ms.notificationService.config.DatabaseConnection;
import fr.insa.ms.notificationService.model.Notification;

@RestController
@RequestMapping("/api/notifications")
public class NotificationController {
	
	@PostMapping("/create")
	public void addNotification(@RequestBody Notification notification) {
		String query = "INSERT INTO Notification (id, idUser, message, status, date) VALUES (?, ?, ?, ?, ?)";
		Connection connection = DatabaseConnection.getConnection();
	    
		try (PreparedStatement statement = connection.prepareStatement(query, Statement.RETURN_GENERATED_KEYS)) {
        	Random random = new Random();
        	int randomId = random.nextInt(1_000_000) + 1; 
        	notification.setId(randomId);
        	
        	String unread = "UNREAD";
        	notification.setStatus(unread);
	}

}
