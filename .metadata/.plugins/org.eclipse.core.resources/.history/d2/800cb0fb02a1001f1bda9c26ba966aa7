package fr.insa.ms.userInfoService.controller;



import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import fr.insa.ms.userInfoService.model.UserInfos;

@RestController
@RequestMapping("/api/users")
public class UserController {


    private static final String URL = "jdbc:mysql://localhost:3306/your_database_name";
    private static final String USER = "your_database_username";
    private static final String PASSWORD = "your_database_password";


    // Endpoint to get a list of all users
    @GetMapping("/all")
    public List<UserInfos> getAllUsers() throws SQLException {
        List<UserInfos> users = new ArrayList<>();
        String query = "SELECT * FROM users";
        
        try (Connection connection = DriverManager.getConnection(URL, USER, PASSWORD);
             Statement statement = connection.createStatement();
             ResultSet resultSet = statement.executeQuery(query)) {
            
            while (resultSet.next()) {
                users.add(new UserInfos(
                        resultSet.getLong("id"),
                        resultSet.getString("name"),
                        resultSet.getString("email"),
                        resultSet.getString("password"),
                        UserInfos.HelpStatus.valueOf(resultSet.getString("help_status"))
                ));
            }
        }
        return users;
    }


    // Endpoint to get a specific user by ID
    @GetMapping("/{id}")
    public User getUserById(@PathVariable Long id) throws SQLException {
        String query = "SELECT * FROM users WHERE id = ?";
        try (Connection connection = DriverManager.getConnection(URL, USER, PASSWORD);
             PreparedStatement statement = connection.prepareStatement(query)) {
            
            statement.setLong(1, id);
            ResultSet resultSet = statement.executeQuery();


            if (resultSet.next()) {
                return new User(
                        resultSet.getLong("id"),
                        resultSet.getString("name"),
                        resultSet.getString("email"),
                        resultSet.getString("password"),
                        User.HelpStatus.valueOf(resultSet.getString("help_status"))
                );
            }
        }
        return null;
    }
}
